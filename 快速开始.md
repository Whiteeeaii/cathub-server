# 🚀 Cathub 快速开始指南

## 第一步：启动后端服务器

### 方法 1：使用启动脚本（推荐）

1. 双击运行 `backend/start_server.bat`
2. 等待服务器启动完成

### 方法 2：手动启动

打开 PowerShell，运行：

```powershell
cd backend
pip install -r requirements.txt
python server.py
```

看到以下输出表示成功：
```
🐱 Cathub 后端服务器启动中...
📡 API 地址: http://localhost:5000
```

**✅ 保持这个窗口运行，不要关闭！**

---

## 第二步：测试后端 API（可选）

**新开一个 PowerShell 窗口**，运行：

```powershell
cd backend
python test_api.py
```

如果看到 `✅ 所有测试通过！`，说明后端工作正常。

---

## 第三步：启动 ngrok 内网穿透

### 首次使用需要安装 ngrok

1. 访问 https://ngrok.com/download
2. 下载 Windows 版本
3. 解压到任意目录（如 `C:\ngrok\`）
4. 访问 https://dashboard.ngrok.com/signup 注册账号
5. 在控制台复制 authtoken
6. 在 ngrok 目录打开 PowerShell，运行：
   ```powershell
   .\ngrok config add-authtoken YOUR_AUTH_TOKEN
   ```

### 启动 ngrok

**方法 1：使用启动脚本**

双击运行 `backend/start_ngrok.bat`

**方法 2：手动启动**

在 ngrok 目录打开 PowerShell，运行：

```powershell
.\ngrok http 5000
```

### 复制公网地址

看到类似输出：
```
Forwarding  https://abc123.ngrok-free.app -> http://localhost:5000
```

**📋 复制这个 `https://abc123.ngrok-free.app` 地址！**

**✅ 保持这个窗口运行，不要关闭！**

---

## 第四步：配置 Android App

### 1. 打开 Android Studio

导入项目：`文件` → `打开` → 选择 `android` 文件夹

### 2. 等待 Gradle 同步完成

首次打开会自动下载依赖，需要等待几分钟。

### 3. 配置服务器地址

打开文件：
```
android/app/src/main/java/com/cathub/app/data/api/RetrofitClient.kt
```

找到第 17 行，修改为您的 ngrok 地址：

```kotlin
// 修改前
private const val BASE_URL = "http://10.0.2.2:5000/"

// 修改后（替换为您的 ngrok 地址）
private const val BASE_URL = "https://abc123.ngrok-free.app/"
```

**⚠️ 注意：地址末尾要有斜杠 `/`**

### 4. 同步项目

点击顶部的 `Sync Now` 或 `File` → `Sync Project with Gradle Files`

---

## 第五步：运行 App

### 使用真机（推荐）

1. 用 USB 线连接 Android 手机
2. 在手机上开启"开发者选项"和"USB 调试"
3. 在 Android Studio 顶部选择您的设备
4. 点击绿色的 ▶️ 运行按钮

### 使用模拟器

1. 点击 `Tools` → `Device Manager`
2. 创建一个新设备（推荐 Pixel 6，API 34）
3. 启动模拟器
4. 点击绿色的 ▶️ 运行按钮

---

## 🎉 开始使用

App 启动后，您会看到主页三个卡片：

1. **识别** - 识别猫咪（开发中）
2. **上报** - 上报健康状态（开发中）
3. **档案** - 管理猫咪档案 ✅

### 试试添加第一只猫咪

1. 点击"档案"卡片
2. 点击右下角的 ➕ 按钮
3. 填写猫咪信息：
   - 名字：雪球
   - 性别：母猫
   - 年龄：18 个月
   - 花色：三花
   - 活动区域：小区东门,停车场
   - 性格：温顺,胆小
   - 食物喜好：鸡胸肉,幼猫粮
   - 投喂建议：避免乳制品；少量多餐
4. 点击"保存"

### 查看档案

返回列表页，您会看到刚创建的猫咪档案。点击可查看详情。

---

## 🐛 遇到问题？

### App 无法连接服务器

**检查清单：**
- [ ] 后端服务器是否在运行？
- [ ] ngrok 是否在运行？
- [ ] `RetrofitClient.kt` 中的地址是否正确？
- [ ] 地址末尾是否有斜杠 `/`？
- [ ] 手机是否有网络连接？

**查看日志：**
在 Android Studio 底部打开 `Logcat`，搜索 "OkHttp" 或 "Retrofit"

### ngrok 地址每次都变

免费版 ngrok 每次重启地址会变化，需要：
1. 重新复制新地址
2. 更新 `RetrofitClient.kt`
3. 重新运行 App

**解决方案：**
- 升级到 ngrok 付费版（$8/月）获得固定域名
- 或使用其他内网穿透工具（如 frp、Cloudflare Tunnel）

### Gradle 同步失败

**国内用户可能需要配置镜像：**

在 `android/build.gradle.kts` 中添加：

```kotlin
allprojects {
    repositories {
        maven { url = uri("https://maven.aliyun.com/repository/public") }
        maven { url = uri("https://maven.aliyun.com/repository/google") }
        google()
        mavenCentral()
    }
}
```

### Python 依赖安装失败

使用国内镜像：

```powershell
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

## 📚 下一步

- 查看 `README.md` 了解完整功能
- 查看 `Cathub_App_开发说明书.md` 了解技术细节
- 开始开发识别功能（CameraX + TensorFlow Lite）

---

## 💡 提示

### 开发时的工作流程

1. 启动后端服务器（`backend/start_server.bat`）
2. 启动 ngrok（`backend/start_ngrok.bat`）
3. 复制 ngrok 地址到 `RetrofitClient.kt`
4. 运行 Android App
5. 开发和测试
6. 完成后关闭所有窗口

### 每次重启电脑后

只需重复上述步骤 1-4 即可。

### 数据持久化

所有数据存储在 `backend/cathub.db`，即使重启服务器数据也不会丢失。

---

**祝您开发顺利！🐱**

